"""상수 및 설정 값 정의 - 중복 제거 및 중앙 관리"""

# ============================================
# 세션 관련 상수
# ============================================
SESSION_ID_PREFIX = "mts_"

# ============================================
# 병원 매핑 (CRF 데이터용)
# ============================================
HOSPITAL_MAPPING = {
    "세브란스": "01",
    "연세": "01",
    "신촌세브란스": "01",
    "계명대": "02",
    "계명": "02",
    "계명대학교": "02",
    "분당차": "03",
    "차병원": "03",
    "차의과": "03",
    "강남세브란스": "04",
    "강남차": "05",
    "단국대": "06",
    "단국": "06",
    "단국대학교": "06",
    "이화여대": "07",
    "이대목동": "07",
    "이화": "07",
    "이대": "07",
}

# 병원 추출 우선순위 (긴 이름부터 매칭)
# 예: "강남세브란스"를 "세브란스"보다 먼저 체크
HOSPITAL_PRIORITY = [
    "강남세브란스",
    "강남차",
    "분당차",
    "차병원",
    "차의과",
    "세브란스",
    "신촌세브란스",
    "연세",
    "계명대학교",
    "계명대",
    "계명",
    "단국대학교",
    "단국대",
    "단국",
    "이대목동",
    "이화여대",
    "이화",
    "이대",
]

# ============================================
# Top-K 설정 (검색 결과 개수)
# ============================================
DEFAULT_TOP_K = {
    "crf": 50,              # CRF는 데이터가 많아서 더 많이 검색
    "version": 50,          # 버전 비교 질문
    "technical": 30,        # 기술적 질문
    "general": 15,          # 일반 질문
    "recent": 100,          # 최신 질문
}

# ============================================
# 컨텍스트 제한 (프롬프트에 포함할 문서 수)
# ============================================
CONTEXT_LIMITS = {
    "crf": None,            # CRF는 제한 없음 (전체 사용)
    "redmine": 15,          # Redmine은 15개
    "document": 15,         # 일반 문서도 15개
}

# ============================================
# 대화 히스토리 설정
# ============================================
CHAT_HISTORY_CONFIG = {
    "max_turns_in_memory": 10,      # 세션에 저장할 최대 턴 수
    "max_recent_turns": 3,          # 프롬프트에 포함할 최근 턴 수
    "max_relevant_history": 10,     # 검색된 과거 대화 최대 개수
    "search_history_threshold": 2,  # 과거 대화 검색 시작 턴 수
    "ttl_days": 730,                # 대화 만료 기간 (2년)
}

# ============================================
# 키워드 검색 설정
# ============================================
KEYWORD_SEARCH_CONFIG = {
    "limit_per_keyword": 20,        # 키워드당 검색 결과 수
}

# ============================================
# 검색 쿼리 구성 설정
# ============================================
SEARCH_QUERY_CONFIG = {
    "recent_turns_to_include": 2,  # 맥락 검색에 포함할 최근 턴 수
    "crf_answer_keywords": ["병원", "CRF", "환자", "임상", "병리번호", "record_id"],
    "redmine_answer_keywords": ["이슈", "issue", "#"],
    "redmine_answer_exclude_keywords": ["병원", "CRF", "환자"],
}

# ============================================
# 라우팅 및 유사도 비교 설정
# ============================================
ROUTING_SIMILARITY_THRESHOLD = 0.05  # 벡터 거리 차이 임계값 (5% 차이)

# ============================================
# 디버그 설정
# ============================================
DEBUG_CONFIG = {
    "crf_chunk_logging": True,   # CRF 통계/메타데이터 청크 정보 로깅 여부
}
